<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>360 Image + Spider Model + Random Auto Sound</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- ç…§æ˜ -->
      <a-light type="ambient" color="#777"></a-light>
      <a-light type="directional" color="#fff" position="1 2 2"></a-light>

      <!-- èƒŒæ™¯ -->
      <a-sky src="mori.jpg" rotation="0 -130 0"></a-sky>

      <!-- ğŸ•·ï¸ ã‚¯ãƒ¢ãƒ¢ãƒ‡ãƒ«ï¼ˆå›è»¢ã¯å‰Šé™¤ï¼‰ -->
      <a-entity 
        id="spider"
        gltf-model="spider.glb"
        position="0 -1.5 -3"
        rotation="0 180 0"
        scale="0.1 0.1 0.1
        "
        animation-mixer>
      </a-entity>

      <!-- åŠ¹æœéŸ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ -->
      <a-entity id="sound-player"></a-entity>
    </a-scene>

    <script>
      // --- å¿…è¦ãªã‚‰ãƒ‘ã‚¹ã‚’å®Ÿéš›ã®é…ç½®ã«åˆã‚ã›ã‚‹ ---
      const soundFiles = [
        "VR/åŠ¹æœéŸ³/hell_gear.mp3",
        "VR/åŠ¹æœéŸ³/çªé¢¨ãŒå¹ã.mp3",
        "VR/åŠ¹æœéŸ³/é¢¨ãŒå¹ã1.mp3",
        "VR/åŠ¹æœéŸ³/é¢¨ãŒå¹ã2.mp3",
        "VR/åŠ¹æœéŸ³/é¢¨ãŒå¹ã3.mp3",
        "VR/åŠ¹æœéŸ³/é¢¨ãŒå¹ã4.mp3"
      ];

      // DOMï¼ˆA-Frameã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰èª­ã¿è¾¼ã¿å¾Œã«å‡¦ç†
      window.addEventListener('load', () => {
        const soundEntity = document.querySelector('#sound-player');
        if (!soundEntity) {
          console.error("sound-player ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚IDã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        // å†ç”Ÿé–¢æ•°
        function playRandomSound(volume = 1.0) {
          const randomSound = soundFiles[Math.floor(Math.random() * soundFiles.length)];
          console.log("å†ç”Ÿ:", randomSound, "volume:", volume);

          // sound å±æ€§ã‚’ã‚»ãƒƒãƒˆï¼ˆæ—¢å­˜ã®ã‚‚ã®ã‚’ä¸Šæ›¸ãï¼‰
          soundEntity.setAttribute('sound', `src: url(${randomSound}); autoplay: true; loop: false; volume: ${volume};`);

          // èª­ã¿è¾¼ã¿æˆåŠŸï¼å¤±æ•—ã‚’ãƒ­ã‚°
          soundEntity.addEventListener('sound-loaded', function onLoad() {
            console.log("sound-loaded:", randomSound);
            // autoplay:true ãªã®ã§é€šå¸¸ã¯å†ç”Ÿã•ã‚Œã‚‹ã¯ãšã ãŒã€å®‰å…¨ã®ãŸã‚ playSound() ã‚’å‘¼ã¶
            try {
              soundEntity.components.sound.playSound();
            } catch (e) {
              console.warn("playSound() ã®å‘¼ã³å‡ºã—ã§ã‚¨ãƒ©ãƒ¼:", e);
            }
            soundEntity.removeEventListener('sound-loaded', onLoad);
          });

          soundEntity.addEventListener('sound-error', function onErr(evt) {
            console.error("sound-error:", evt);
            soundEntity.removeEventListener('sound-error', onErr);
          });
        }

        // è‡ªå‹•å†ç”Ÿå¯¾ç­–ï¼šæœ€åˆã¯ç„¡éŸ³ã§å†ç”Ÿ â†’ å°‘ã—ã—ã¦éŸ³é‡ã‚’ä¸Šã’ã‚‹
        playRandomSound(0.0); // ç„¡éŸ³ã§æœ€åˆã«èª­ã¿è¾¼ã¿ãƒ»å†ç”Ÿï¼ˆè¨±å¯ã•ã‚Œã‚„ã™ãã™ã‚‹ï¼‰
        setTimeout(() => {
          // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã®Audioè¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦éŸ³é‡ã‚’ä¸Šã’ã‚‹
          try {
            const audio = soundEntity.components.sound && soundEntity.components.sound.pool && soundEntity.components.sound.pool.children[0];
            if (audio) {
              audio.volume = 1.0;
              console.log("æœ€åˆã®éŸ³é‡ã‚’1.0ã«å¤‰æ›´");
            } else {
              console.warn("audioè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆã¾ã ãƒ­ãƒ¼ãƒ‰ä¸­ã‹ã‚‚ï¼‰");
            }
          } catch (e) {
            console.warn("éŸ³é‡è¨­å®šã§ä¾‹å¤–:", e);
          }
        }, 1000);

        // ãƒ©ãƒ³ãƒ€ãƒ é–“éš”ã§æ¬¡ã®å†ç”Ÿã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°
        function scheduleNext() {
          const delay = Math.random() * 7000 + 8000; // 8ã€œ15ç§’
          setTimeout(() => {
            playRandomSound(1.0);
            scheduleNext();
          }, delay);
        }

        // é–‹å§‹ï¼ˆæœ€åˆã®ç„¡éŸ³å†ç”Ÿã®å¾Œã«æœ¬æ ¼ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹ï¼‰
        setTimeout(scheduleNext, 1500);
      });
    </script>
  </body>
</html>
