<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Kaijyu Jump Scare (Fixed Position Random Timing)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- ç…§æ˜ -->
      <a-light type="ambient" color="#222"></a-light>
      <a-light type="directional" color="#888" position="2 4 3"></a-light>

      <!-- èƒŒæ™¯ -->
      <a-sky src="mori.jpg" rotation="0 -130 0"></a-sky>

      <!-- åŠ¹æœéŸ³å†ç”Ÿç”¨ -->
      <a-entity id="sound-player"></a-entity>

      <!-- ã‚«ãƒ¡ãƒ© -->
      <a-entity id="cameraRig" position="0 -1 5">
        <a-camera look-controls></a-camera>
      </a-entity>

      <!-- ãƒ¢ãƒ‡ãƒ« -->
      <a-assets>
        <a-asset-item id="kaijyu-asset" src="kaijyu.glb"></a-asset-item>
        <a-asset-item id="spider-asset" src="spider.glb"></a-asset-item>
      </a-assets>

      <!-- ğŸ¦– æ€ªç£ï¼ˆåˆæœŸã¯éè¡¨ç¤ºï¼‰ -->
      <a-entity
        id="kaijyu"
        gltf-model="#kaijyu-asset"
        position="0 -2.5 -20"
        rotation="0 0 0"
        scale="1.5 1.5 1.5"
        visible="false">
      </a-entity>

      <!-- ğŸ•·ï¸ èœ˜è›› -->
      <a-entity
        id="spider"
        gltf-model="#spider-asset"
        position="1 -3 14"
        scale="1.5 1.5 1.5"
        rotation="0 180 0">
      </a-entity>
    </a-scene>

    <script>
      const kaijyu = document.querySelector('#kaijyu');
      const soundEntity = document.querySelector('#sound-player');

      // ğŸ¦– æ€ªç£ã‚’å°‘ã—æš—ã‚ã«
      kaijyu.addEventListener('model-loaded', () => {
        kaijyu.object3D.traverse(node => {
          if (node.isMesh && node.material) node.material.color.multiplyScalar(0.7);
        });
      });

      // ğŸµ åŠ¹æœéŸ³
      const roarSound = "åŠ¹æœéŸ³/hell_gear.mp3";
      const ambientSounds = [
        "åŠ¹æœéŸ³/é¢¨ãŒå¹ã1.mp3",
        "åŠ¹æœéŸ³/é¢¨ãŒå¹ã2.mp3",
        "åŠ¹æœéŸ³/çªé¢¨ãŒå¹ã.mp3"
      ];

      function playSound(file, volume = 1.0) {
        soundEntity.removeAttribute('sound');
        soundEntity.setAttribute('sound', {
          src: `url(${file})`,
          autoplay: true,
          volume: volume,
          loop: false
        });
      }

      // ğŸŒ² èƒŒæ™¯éŸ³ã‚’ãƒ«ãƒ¼ãƒ—å†ç”Ÿ
      function startAmbientLoop() {
        let i = 0;
        playSound(ambientSounds[i]);
        setInterval(() => {
          i = (i + 1) % ambientSounds.length;
          playSound(ambientSounds[i], 0.6);
        }, 10000);
      }

      // ğŸ’¥ å‡ºç¾æ¼”å‡º
      function triggerKaijyuJumpScare() {
        kaijyu.setAttribute("visible", "true");
        kaijyu.setAttribute("animation__jump", {
          property: "position",
          from: "0 -2.5 -20",
          to: "0 -2.5 -3",
          dur: 200,
          easing: "easeOutQuad"
        });
        playSound(roarSound, 1.2);

        // 5ç§’å¾Œã«æ¶ˆãˆã‚‹
        setTimeout(() => {
          kaijyu.setAttribute("visible", "false");
          kaijyu.removeAttribute("animation__jump");
          kaijyu.setAttribute("position", "0 -2.5 -20"); // ã‚‚ã¨ã«æˆ»ã™
        }, 5000);
      }

      // ğŸ² ãƒ©ãƒ³ãƒ€ãƒ å‡ºç¾ãƒ«ãƒ¼ãƒ—
      function startKaijyuLoop() {
        function scheduleNext() {
          // 5ã€œ15ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ é–“éš”
          const delay = Math.random() * 10000 + 5000;
          setTimeout(() => {
            triggerKaijyuJumpScare();
            scheduleNext(); // æ¬¡ã‚‚äºˆç´„
          }, delay);
        }
        scheduleNext();
      }

      // â–¶ åˆå›ã‚¯ãƒªãƒƒã‚¯ã§é–‹å§‹
      window.addEventListener('click', () => {
        startAmbientLoop();
        startKaijyuLoop();
        console.log("ğŸ’¥ ãƒ©ãƒ³ãƒ€ãƒ æ€ªç£å‡ºç¾ãƒ«ãƒ¼ãƒ—é–‹å§‹");
      }, { once: true });
    </script>
  </body>
</html>
