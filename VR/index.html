<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Kaijyu Random Appear Scare</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- ç…§æ˜ -->
      <a-light type="ambient" color="#222"></a-light>
      <a-light type="directional" color="#888" position="2 4 3"></a-light>

      <!-- èƒŒæ™¯ -->
      <a-sky src="mori.jpg" rotation="0 -130 0"></a-sky>

      <!-- åŠ¹æœéŸ³ -->
      <a-entity id="sound-player"></a-entity>

      <!-- ã‚«ãƒ¡ãƒ© -->
      <a-entity id="cameraRig" position="0 -1 5">
        <a-camera look-controls></a-camera>
      </a-entity>

      <!-- ãƒ¢ãƒ‡ãƒ« -->
      <a-assets>
        <a-asset-item id="kaijyu-asset" src="kaijyu.glb"></a-asset-item>
      </a-assets>
    </a-scene>

    <script>
      const scene = document.querySelector('a-scene');
      const soundEntity = document.querySelector('#sound-player');

      // ğŸµ åŠ¹æœéŸ³
      const roarSound = "åŠ¹æœéŸ³/hell_gear.mp3";
      const ambientSounds = [
        "åŠ¹æœéŸ³/é¢¨ãŒå¹ã1.mp3",
        "åŠ¹æœéŸ³/é¢¨ãŒå¹ã2.mp3",
        "åŠ¹æœéŸ³/çªé¢¨ãŒå¹ã.mp3"
      ];

      // åŠ¹æœéŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
      function playSound(file, volume = 1.0) {
        soundEntity.removeAttribute('sound');
        soundEntity.setAttribute('sound', {
          src: `url(${file})`,
          autoplay: true,
          volume: volume,
          loop: false
        });
      }

      // ğŸŒ² èƒŒæ™¯éŸ³ã‚’ãƒ«ãƒ¼ãƒ—
      function startAmbientLoop() {
        let i = 0;
        playSound(ambientSounds[i]);
        setInterval(() => {
          i = (i + 1) % ambientSounds.length;
          playSound(ambientSounds[i], 0.6);
        }, 10000);
      }

      // ğŸ¦– ãƒ©ãƒ³ãƒ€ãƒ ãªæ€ªç£ã‚’ç”Ÿæˆã—ã¦å‡ºç¾â†’æ¶ˆæ»…
      function spawnKaijyu() {
        // æœ€å¤§4ä½“åˆ¶é™
        const currentKaijyus = document.querySelectorAll('.kaijyu');
        if (currentKaijyus.length >= 4) return;

        // ãƒ©ãƒ³ãƒ€ãƒ ä½ç½®ã‚’æ±ºå®šï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‰æ–¹10ã€œ20mã®ç¯„å›²ï¼‰
        const randomX = (Math.random() - 0.5) * 20; // -10ã€œ10
        const randomZ = - (Math.random() * 15 + 8); // -8ã€œ-23
        const randomY = -2.5;

        // æ€ªç£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ç”Ÿæˆ
        const kaijyu = document.createElement('a-entity');
        kaijyu.setAttribute('gltf-model', '#kaijyu-asset');
        kaijyu.setAttribute('position', `${randomX} ${randomY} ${randomZ}`);
        kaijyu.setAttribute('scale', '1.5 1.5 1.5');
        kaijyu.setAttribute('rotation', `0 ${Math.random() * 360} 0`);
        kaijyu.classList.add('kaijyu');
        kaijyu.setAttribute('visible', 'false');

        // ãƒ¢ãƒ‡ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰æ˜ã‚‹ã•èª¿æ•´
        kaijyu.addEventListener('model-loaded', () => {
          kaijyu.object3D.traverse(node => {
            if (node.isMesh && node.material) node.material.color.multiplyScalar(0.7);
          });
        });

        scene.appendChild(kaijyu);

        // å°‘ã—é…ã‚Œã¦å‡ºç¾ï¼ˆã³ã£ãã‚Šæ„Ÿã‚¢ãƒƒãƒ—ï¼‰
        setTimeout(() => {
          kaijyu.setAttribute('visible', 'true');
          playSound(roarSound, 1.0);
        }, 200);

        // 5ç§’å¾Œã«æ¶ˆã™
        setTimeout(() => {
          kaijyu.setAttribute('visible', 'false');
          scene.removeChild(kaijyu);
        }, 5000);
      }

      // ğŸ” ãƒ©ãƒ³ãƒ€ãƒ é–“éš”ã§å‡ºç¾ã‚’ç¹°ã‚Šè¿”ã™
      function startKaijyuLoop() {
        setInterval(() => {
          // 1ã€œ2ä½“ãƒ©ãƒ³ãƒ€ãƒ å‡ºç¾
          const spawnCount = Math.floor(Math.random() * 2) + 1;
          for (let i = 0; i < spawnCount; i++) {
            setTimeout(spawnKaijyu, Math.random() * 2000); // å°‘ã—ã‚ºãƒ©ã—ã¦å‡ºç¾
          }
        }, 8000); // 8ç§’ã”ã¨ã«æ–°ã—ã„å‡ºç¾ã‚¤ãƒ™ãƒ³ãƒˆ
      }

      // â–¶ åˆå›ã‚¯ãƒªãƒƒã‚¯ã§é–‹å§‹
      window.addEventListener('click', () => {
        startAmbientLoop();
        startKaijyuLoop();
        console.log("ğŸ’¥ ãƒ©ãƒ³ãƒ€ãƒ æ€ªç£å‡ºç¾ãƒ«ãƒ¼ãƒ—é–‹å§‹");
      }, { once: true });
    </script>
  </body>
</html>
