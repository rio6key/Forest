<script>
  const kaijyu = document.querySelector('#kaijyu');

  kaijyu.addEventListener('model-loaded', () => {
    kaijyu.object3D.traverse(node => {
      if (node.isMesh && node.material) {
        node.material.color.multiplyScalar(0.7);
      }
    });
  });

  const roarSound = "åŠ¹æžœéŸ³/hell_gear.mp3";
  const ambientSounds = [
    "åŠ¹æžœéŸ³/é¢¨ãŒå¹ã1.mp3",
    "åŠ¹æžœéŸ³/é¢¨ãŒå¹ã2.mp3",
    "åŠ¹æžœéŸ³/çªé¢¨ãŒå¹ã.mp3"
  ];

  const soundEntity = document.querySelector('#sound-player');

  function playSound(file, volume = 1.0) {
    soundEntity.removeAttribute('sound');
    soundEntity.setAttribute('sound', {
      src: `url(${file})`,
      autoplay: true,
      volume: volume,
      loop: false
    });
    console.log("ðŸŽµ å†ç”Ÿ:", file);
  }

  function startAmbientLoop() {
    let i = 0;
    playSound(ambientSounds[i], 0.6);
    setInterval(() => {
      i = (i + 1) % ambientSounds.length;
      playSound(ambientSounds[i], 0.6);
    }, 10000);
  }

  // ðŸ”¥ ãƒ©ãƒ³ãƒ€ãƒ ä½ç½®ç”Ÿæˆï¼ˆã‚«ãƒ¡ãƒ©å‘¨ã‚Šãƒ©ãƒ³ãƒ€ãƒ ï¼‰
  function getRandomSpawnPosition() {
    const x = (Math.random() * 20 - 10).toFixed(2); // -10ã€œ10
    const z = (Math.random() * -15 - 5).toFixed(2); // -5ã€œ-20ï¼ˆå‰æ–¹ï¼‰
    return `${x} -2.5 ${z}`;
  }

  // ðŸ¦– ã‚¸ãƒ£ãƒ³ãƒ—ã‚¹ã‚±ã‚¢æ¼”å‡º
  function triggerKaijyuJumpScare() {
    kaijyu.setAttribute("visible", "true");

    // ãƒ©ãƒ³ãƒ€ãƒ ä½ç½®ã‹ã‚‰å‡ºç¾
    const spawnPos = getRandomSpawnPosition();
    const endPos = "0 -2.5 -2";   // è¿«ã£ã¦ãã‚‹å ´æ‰€

    kaijyu.setAttribute("position", spawnPos);

    // å‰ã¸é£›ã³å‡ºã™ã‚¢ãƒ‹ãƒ¡
    kaijyu.setAttribute("animation__jump", {
      property: "position",
      to: endPos,
      dur: 300,
      easing: "easeOutQuad"
    });

    kaijyu.setAttribute("animation__scale", {
      property: "scale",
      from: "1.5 1.5 1.5",
      to: "3 3 3",
      dur: 300
    });

    playSound(roarSound, 1.2);
    console.log("ðŸ’¥ æ€ªç£ã‚¸ãƒ£ãƒ³ãƒ—ã‚¹ã‚±ã‚¢ç™ºå‹•ï¼");

    // ðŸ‘‡ 3ç§’å¾Œã«æ¶ˆã™
    setTimeout(() => {
      kaijyu.setAttribute("visible", "false");
      kaijyu.setAttribute("scale", "1.5 1.5 1.5");
    }, 3000);

    // ðŸ‘‡ ãƒ©ãƒ³ãƒ€ãƒ é–“éš”ã§å†å‡ºç¾ï¼ˆ5ã€œ10ç§’å¾Œï¼‰
    const nextTime = Math.random() * 5000 + 5000;
    setTimeout(triggerKaijyuJumpScare, nextTime);
  }

  // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰6ç§’å¾Œã«åˆå›žç™ºå‹•
  window.addEventListener('load', () => {
    startAmbientLoop();
    setTimeout(() => {
      triggerKaijyuJumpScare();
    }, 6000);
  });
</script>
